[
{
    regex => '^(\d\d\d\d-\d\d-\d\d \d\d:\d\d:\d\d\.\d+) (\S+):\s(.*)',
    match => 'line',
    actions => [
        sub { my ($state) = @_;
            @{$state->{scratch}}{'timestamp','level','text'} = @{$state->{scratch}{values}};
            ( $state->{scratch}{timestamp_s} = $state->{scratch}{timestamp} ) =~ s/\.\d*$//;
            ( $state->{scratch}{timestamp_m} = $state->{scratch}{timestamp_s} ) =~ s/:\d\d$/:00/;
        } 
    ]
},
{
    regex => '*',
    actions => [
        sub { my ($state) = @_;
            my ($node, $ts, $level) = ($state->{input}{node}, $state->{scratch}{timestamp_m}, $state->{scratch}{level});
            $state->{stats}{$ts}{$node}{lines}++;
            $state->{stats}{$ts}{$node}{$level}++;
        } 
    ]
},
{
    regex => '^\[Event:id=(.*?)\]',
    actions => [
        sub { my ($state) = @_;
            my $event_name = 'Event_' . $state->{scratch}{values}[0];
            my ($node, $ts) = ($state->{input}{node}, $state->{scratch}{timestamp_m});
            $event_name =~ s/ /-/g;
            #print "event match: $event_name.\n";
            $state->{stats}{$ts}{$node}{$event_name}++;
        } 
    ]
}
]
